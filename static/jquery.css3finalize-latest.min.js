/**
 * @author Han Lin Yap < http://zencodez.net/ >
 * @copyright 2010 zencodez.net
 * @license http://creativecommons.org/licenses/by-sa/3.0/
 * @package Css3-Finalize
 * @version 1.19 - 2010-12-11
 * @website https://github.com/codler/jQuery-Css3-Finalize
 *
 * == Description == 
 * Some css3 attributes needs to have a prefix in front 
 * in order to work in different browser. The plugin takes 
 * care of that so you only need to write without the prefix.
 *
 * == Example Usage ==
 * // This will look for all style-tags and parse them.
 * $('style').cssFinalize();
 */
(function(a){a.cssFinalizeSetup={shim:true,defaultNode:"style,link"};a.fn.cssFinalize=function(b){a.cssFinalize(this,b);return this};a.cssFinalize=function(s,g){var o=document.createElement("div");g=a.extend({},a.cssFinalizeSetup,g);s=s||g.defaultNode;var t=false;if(a.browser.webkit||a.browser.safari){t="webkit"}else{if(a.browser.mozilla){t="moz"}else{if(a.browser.msie){if(a.browser.version<=7&&!g.shim){return true}t="ms"}else{if(a.browser.opera){t="o"}}}}function f(y,z){return function(A){return(t==y)?z:false}}var h="animation animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-timing-function";h+=" backface-visibility";h+=" background-clip background-origin background-size";h+=" border-corner-image border-image border-top-image border-right-image border-bottom-image border-left-image border-top-left-image border-top-right-image border-bottom-left-image border-bottom-right-image border-radius";h+=" box-align box-direction box-flex box-flex-group box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing";h+=" column-count column-gap column-rule column-rule-color column-rule-style column-rule-width column-width columns";h+=" marquee marquee-direction marquee-speed marquee-style";h+=" perspective perspective-origin tab-size text-overflow text-size-adjust";h+=" transform transform-origin transform-style";h+=" transition transition-delay transition-duration transition-property transition-timing-function";h+=" user-modify user-select";h=h.split(" ");var k={"border-top-left-radius":[f("moz","-moz-border-radius-topleft")],"border-top-right-radius":[f("moz","-moz-border-radius-topright")],"border-bottom-right-radius":[f("moz","-moz-border-radius-bottomright")],"border-bottom-left-radius":[f("moz","-moz-border-radius-bottomleft")]};function e(y){var z="";a.each(y,function(A,B){z+=B.selector+"{";if(a.isArray(B.attributes)){z+=e(B.attributes)}else{a.each(B.attributes,function(D,C){z+=D+":"+C+";"})}z+="}"});return z}function v(A){if(t=="ms"&&a.browser.version<=7){var z=x(A,"(:[^;]*;?)")}else{var z=A.split(/(:[^;]*;?)/)}z.pop();var y={};a.map(z,function(C,B){if(B%2==1){y[a.trim(z[B-1])]=a.trim(C.substr(1).replace(";",""))}});return y}function x(B,A){var y=B.match(RegExp(A,"g"));var z=B.replace(new RegExp(A,"g"),"[|]").split("[|]");var C=[];for(i in z){C.push(z[i]);if(y!=null&&y[i]!=undefined){C.push(y[i])}}return C}function d(F){if(t=="ms"&&a.browser.version<=7){var A=x(F,"({[^{}]*})")}else{var A=F.split(/({[^{}]*})/)}if(A[A.length-1].indexOf("}")==-1){A.pop()}var B=[];var y=false;var G;var D=0;var E;var C=0;while(C<A.length){if(C%2==0){var z=a.trim(A[C]);if(y){if(z.indexOf("}")!=-1){z=z.substr(1);A[C]=z;E=A.splice(D,C-D);E.shift();E.unshift(G[1]);B[B.length-1].attributes=d(E.join(""));y=false;C=D;continue}}else{if(z.indexOf("{")!=-1){G=z.split("{");z=a.trim(G[0]);y=true;D=C}if(z!=""){B.push({selector:z})}}}else{if(!y){B[B.length-1].attributes=v(A[C].substr(1,A[C].length-2))}}C++}return B}function u(y){y=y.replace(/\/\*((?:[^\*]|\*[^\/])*)\*\//g,"");y=y.replace(/\n/g,"");y=y.replace(/\r/g,"");y=y.replace(/\@import[^;]*;/g,"");return y}function p(y){if(a.isArray(y)){return{}}var z={};a.each(y,function(D,C){var A=q(D);if(A){z[A]=C}var E=l(D,C,A);if(E){z[(A)?A:D]=E}var B=r(D,C);if(B){z[B.property]=B.value}});return z}function q(z){if(z in k){for(prefix in k[z]){if(a.isFunction(k[z][prefix])){var y=k[z][prefix](z);if(y){return y}}else{if(t==k[z][prefix]||!t){return"-"+k[z][prefix]+"-"+z}}}}if(a.inArray(z,h)>-1){if(!(a.camelCase(z) in o.style)){if(a.camelCase("-"+t+"-"+z) in o.style){return"-"+t+"-"+z}}}return false}function l(A,z,y){y=y||A;if(A=="background-clip"||A=="background-origin"){o.style.cssText=y+":"+z;if(o.style[a.camelCase(y)]!==undefined&&""+o.style[a.camelCase(y)].indexOf(z)==-1){return z.split("-")[0]}}if(t=="moz"){if(z.indexOf("calc")==0){return"-moz-"+z}}if(g.shim){if(t=="ms"){if(a.browser.version<=7){if(A.toUpperCase()=="DISPLAY"&&z=="inline-block"){return"inline"}}}}return false}function r(z,y){if(g.shim){if(t=="ms"){if(a.browser.version<=7){if(z.toUpperCase()=="BACKGROUND-COLOR"&&y.indexOf("rgba")==0){y=b(y);return{property:"filter",value:"progid:DXImageTransform.Microsoft.gradient(startColorStr='"+y+"',EndColorStr='"+y+"')"}}}else{if(a.browser.version==8){if(z.toUpperCase()=="BACKGROUND-COLOR"&&y.indexOf("rgba")==0){y=b(y);return{property:"-ms-filter",value:"\"progid:DXImageTransform.Microsoft.gradient(startColorStr='"+y+"',EndColorStr='"+y+"')\""}}}}}}return false}function m(y){if(t=="moz"){y=y.replace("::selection","::-moz-selection")}else{if(t=="webkit"){y=y.replace("@keyframes","@-webkit-keyframes")}}return y}function b(C){var z=C.replace(/^rgba\s?\(\s?(.*?)\s?\)$/,"$1").split(/,\s?/);var y=[];var B;for(var A=0;A<z.length;A++){if(A==3){z[A]*=255}B="0"+parseInt(z[A],10).toString(16);y.push(B.substr(B.length-2,2).toUpperCase())}y.splice(0,0,y.pop());return"#"+y.join("")}function c(z,A){A=u(A);if(a.trim(A)==""){return}var B=d(A);var y=[];a.each(B,function(C,E){if(E.attributes){var D=p(E.attributes);if(!a.isEmptyObject(D)){y.push({selector:m(E.selector),attributes:D})}else{if(m(E.selector)!=E.selector){y.push({selector:m(E.selector),attributes:E.attributes})}}}});z.addClass("css-finalize-read");if(y.length>0){w(z,y)}}if(!(s instanceof jQuery)){s=a(s)}s.each(function(y,z){var A=a(this);if(A.hasClass("css-finalize-read")||A.hasClass("css-finalized")){return true}if(this.tagName=="LINK"&&A.attr("rel")=="stylesheet"){j(this.href,A)}else{c(A,A.html())}});function j(y,z){try{a("<div />").load(y,function(B){c(z,B)})}catch(A){}}function w(y,z){y.after('<style class="css-finalized">'+e(z)+"</style>")}if(a.cssHooks){for(property in k){if((newProperty=q(property))!==false){n(property,newProperty)}}for(property in h){if((newProperty=q(h[property]))!==false){n(h[property],newProperty)}}}function n(z,y){y=a.camelCase(y);if(t=="ms"&&a.browser.version<=8){y=y.charAt(0).toLowerCase()+y.substr(1)}a.cssHooks[a.camelCase(z)]={get:function(C,B,A){return C.style[y]},set:function(A,B){A.style[y]=B}}}};a(function(){if(window.cssFinalize!==false){a.cssFinalize()}})})(jQuery);